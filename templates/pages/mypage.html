{% extends "page_layouts/main_layout.html" %}

{% block title %}
    마이페이지
{% endblock %}

{% block content %}
    <main class="flex-grow flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">나의 정보</h2>
            <div class="flex flex-col items-center mb-4">
                {% if let Some(avatar_url) = user.avatar_url %}
                    <img src="{{ avatar_url }}" alt="Avatar" class="rounded-full mb-4">
                {% else %}
                    <img src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y" alt="Avatar" class="rounded-full mb-4">
                {% endif %}
                <button class="bg-gray-500 text-white py-1 px-3 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">아바타 변경</button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">현재 닉네임</label>
                <p class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm"> {{ user.nick_name }} </p>
            </div>
            <div class="flex items-center justify-between mb-4">
                <button class="w-full bg-indigo-500 text-white py-2 px-4 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">닉네임 수정</button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">이메일</label>
                <p class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                    {% if let Some(email) = user.email %}
                        {{ email }}
                    {% else %}
                        
                    {% endif %}
                </p>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">가입일</label>
                <p class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm"> {{ user.created_at }} </p>
            </div>
            <div class="flex justify-end ">
                <button class=" bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2" onclick="openModal()">회원 탈퇴</button>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">회원 탈퇴</h2>
            <p class="mb-4">탈퇴 시 회원님의 정보가 모두 삭제되며, 복구할 수 없습니다. 정말 탈퇴하시겠습니까?</p>
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" class="form-checkbox" id="confirmCheckbox">
                    <span class="ml-2">네, 정말 탈퇴하겠습니다.</span>
                </label>
            </div>
            <div class="flex justify-end space-x-2">
                <button class="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2" onclick="closeModal()">취소</button>
                <button class="bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2" onclick="confirmDeletion()">탈퇴</button>
            </div>
        </div>
    </div>

    <script>
        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function confirmDeletion() {
            const checkbox = document.getElementById('confirmCheckbox');
            if (checkbox.checked) {
                htmx.ajax('POST', '/user/withdrawl')
                // 탈퇴 로직 추가
                //alert('탈퇴가 완료되었습니다.');
                //closeModal();
            } else {
                alert('탈퇴 확인 체크박스를 선택해주세요.');
            }
        }
    </script>
{% endblock %}
